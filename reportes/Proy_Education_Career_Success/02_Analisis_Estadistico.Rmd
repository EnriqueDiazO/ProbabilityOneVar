---
title: "Gu√≠a de Gr√°ficos para el An√°lisis Exploratorio de Datos (EDA)"
author: "Enrique D√≠az Ocampo"
date: "`r Sys.Date()`"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```


# 1Ô∏è‚É£ Introducci√≥n

Esta gu√≠a proporciona una serie de gr√°ficos para realizar un An√°lisis Exploratorio de Datos (EDA) en diferentes niveles:

- An√°lisis Unidimensional: Distribuci√≥n de una sola variable.

- An√°lisis Multivariado: Relaci√≥n entre dos o m√°s variables.

- Visualizaci√≥n con ggplot2 para explorar patrones en los datos.

Esta gu√≠a te ayudar√° a seleccionar el gr√°fico m√°s adecuado seg√∫n el tipo de variable analizada.

# 2Ô∏è‚É£ Carga de Librer√≠as y Configuraci√≥n
```{r}
install.packages("here",dependencies = TRUE)
library(here)           # Manejo de rutas din√°micas
source(here("reportes/Proy_Education_Career_Success/00_CONFIGURACION.r"))
```

```{r}
#  Cargar librer√≠as necesarias
library(janitor)        # Limpieza de nombres de columnas
library(summarytools)   # Resumen estad√≠stico detallado
library(ggplot2)        # Gr√°ficos
library(dplyr)          # Manipulaci√≥n de datos
library(plotly)         # Gr√°ficos Interactivos
library(htmlwidgets)
# Configuraci√≥n de gr√°ficos globales
theme_set(theme_minimal())

# Cargar scripts de preprocesamiento
source(here("scripts/utils.r"))
source(here("scripts/1_preprocesamiento_esp_dataset.r"))
source(here("scripts/2_analisis_gr√°fico.r"))

```


# 3Ô∏è‚É£ Carga y Preprocesamiento de Datos

üìå ¬øQu√© hace esta funci√≥n?

‚úî Limpia los nombres de las columnas.

‚úî Convierte variables categ√≥ricas en factores.

‚úî Filtra valores inv√°lidos.

‚úî Retorna un dataset listo para an√°lisis.

```{r}
# üìå Cargar y preprocesar el dataset
dataset_education <- preprocesar_datos(here("datasets/education_data_limpio.csv"), "Education Career Success")
```

# 4Ô∏è‚É£ An√°lisis Unidimensional

El an√°lisis unidimensional permite estudiar la distribuci√≥n de una sola variable.

## üìå Boxplot para una variable cuantitativa (Edad)

```{r}
p_boxplot_edad <- crear_boxplot(
  data = dataset_education,
  y = "age",
  title = "Distribuci√≥n de la Edad de los Estudiantes",
  xlab = "Estudiantes",
  ylab = "Edad",
  fill = NULL,
  colores = "blue"
)

# Guardar y mostrar el gr√°fico
guardar_grafico(p_boxplot_edad, here("reportes/Proy_Education_Career_Success/resultados_generados/boxplot_edad.png"))
convertir_interactivo(p_boxplot_edad)

```


## üìå Histograma para una variable cuantitativa (Edad)
```{r}
# Crear histograma usando la funci√≥n gen√©rica
p_histograma_edad <- crear_histograma(
  data = dataset_education,
  x = "age",  # Variable a graficar
  title = "Distribuci√≥n de Edad de los Estudiantes",  # T√≠tulo del gr√°fico
  xlab = "Edad",  # Etiqueta del eje X
  ylab = "Frecuencia",  # Etiqueta del eje Y
  binwidth = 2,  # Ancho de los bins
  colores = "lightblue",  # Color de relleno
  densidad = TRUE  # Agregar l√≠nea de densidad
)

# Guardar el gr√°fico
guardar_grafico(p_histograma_edad, here("reportes/Proy_Education_Career_Success/resultados_generados/histograma_edad.png"))

# Convertir a gr√°fico interactivo
convertir_interactivo(p_histograma_edad)

```


# üìå  Comparaci√≥n entre histogramas 
```{r}
# Definir colores y etiquetas para la leyenda
colores_genero <- c("Male" = "blue", "Female" = "red", "Other" = "cyan")
etiquetas_leyenda <- c("Hombres", "Mujeres", "Otro")

# Crear el histograma superpuesto
p_salary_histogram <- crear_histograma_filtrado(
  data = dataset_education,
  filtro_columna = "field_of_study",
  filtro_valor = "Mathematics",
  x = "starting_salary",
  fill = "gender",
  title = "Distribuci√≥n del Salario Inicial en Matem√°ticas" ,
  xlab = "Salario Inicial (USD)",
  ylab = "Frecuencia",
  binwidth = 5000,
  colores = colores_genero,
  etiquetas_leyenda = etiquetas_leyenda
)

# Guardar el gr√°fico
guardar_grafico(p_salary_histogram, here("reportes/Proy_Education_Career_Success/resultados_generados/histograma_salario_genero.png"))

# Convertir a gr√°fico interactivo
convertir_interactivo(p_salary_histogram)
```



üìå Barplot para una variable cualitativa (Campo de Estudio)

```{r}
# Crear el gr√°fico de barras apiladas y volteadas
p_barplot_field <- crear_barplot(
  data = dataset_education,
  x = "field_of_study",  # Variable para el eje X
  fill = "field_of_study",  # Variable para el fill
  title = "Distribuci√≥n de Campo de Estudio",  # T√≠tulo del gr√°fico
  xlab = "Campo de Estudio",  # Etiqueta del eje X
  ylab = "Frecuencia",  # Etiqueta del eje Y
  dodge = FALSE,  # Barras apiladas
  voltear = TRUE,  # Voltear el gr√°fico
  legend_position = "none"  # Ocultar la leyenda
)

# Guardar el gr√°fico
guardar_grafico(p_barplot_field, here("reportes/Proy_Education_Career_Success/resultados_generados/barplot_field.png"))

# Convertir a gr√°fico interactivo
convertir_interactivo(p_barplot_field)

```


# 5Ô∏è‚É£ An√°lisis Multivariado

El an√°lisis multivariado permite explorar relaciones entre dos o m√°s variables.

üìå Cualitativa vs Cualitativa (Gr√°fico de barras cruzado)

```{r}
# Crear el gr√°fico de barras agrupadas
p_genero_field <- crear_barplot(
  data = dataset_education,
  x = "gender",  # Variable para el eje X
  fill = "field_of_study",  # Variable para el fill
  title = "Distribuci√≥n de G√©nero por Campo de Estudio",  # T√≠tulo del gr√°fico
  xlab = "G√©nero",  # Etiqueta del eje X
  ylab = "Frecuencia",  # Etiqueta del eje Y
  dodge = TRUE,  # Barras agrupadas
  voltear = FALSE,  # No voltear el gr√°fico
  legend_position = "right"  # Leyenda a la derecha
)

# Guardar el gr√°fico
guardar_grafico(p_genero_field, here("reportes/Proy_Education_Career_Success/resultados_generados/barplot_genero_field.png"))

# Convertir a gr√°fico interactivo
convertir_interactivo(p_genero_field)
```

# üìå Cuantitativa vs Cualitativa (Boxplot de GPA por Campo de Estudio)

```{r}
# Crear el gr√°fico de cajas
p_salary_field <- crear_boxplot(
  data = dataset_education,
  x = "field_of_study",  # Variable para el eje X
  y = "starting_salary",  # Variable para el eje Y
  fill = "field_of_study",  # Variable para el fill
  title = "Distribuci√≥n del Salario Inicial por Campo de Estudio",  # T√≠tulo del gr√°fico
  xlab = "Campo de Estudio",  # Etiqueta del eje X
  ylab = "Salario Inicial (USD)",  # Etiqueta del eje Y
  fill_lab = "Campo de Estudio",  # Etiqueta de la leyenda
  colores = NULL,  # Colores personalizados (opcional)
  rotar_x = TRUE  # Rotar etiquetas del eje X
) +
  theme(
    axis.text.x = element_text(angle = 90, hjust = 1, size = 14),  # Rotar etiquetas del eje X
    legend.position = "none"  # Ocultar la leyenda
  )

# Guardar el gr√°fico
guardar_grafico(p_salary_field, here("reportes/Proy_Education_Career_Success/resultados_generados/boxplot_salary_field.png"))

# Convertir a gr√°fico interactivo
convertir_interactivo(p_salary_field)

```

```{r}
# Definir colores personalizados para g√©nero
colores_genero <- c("Female" = "#E74C3C", "Male" = "#2980B9", "Other" = "#27AE60")

# Crear el gr√°fico interactivo
p_interactive <- crear_boxplot_interactivo(
  data = dataset_education,
  x = "field_of_study",  # Variable para el eje X
  y = "starting_salary",  # Variable para el eje Y
  color = "gender",  # Variable para el color (g√©nero)
  colores = colores_genero,  # Colores personalizados
  title = "Distribuci√≥n del Salario Inicial por Campo de Estudio y G√©nero",  # T√≠tulo del gr√°fico
  xlab = "Campo de Estudio",  # Etiqueta del eje X
  ylab = "Salario Inicial (USD)",  # Etiqueta del eje Y
  tickangle = -45  # Rotar etiquetas del eje X
)

# Mostrar el gr√°fico interactivo
p_interactive


```

# üìå Cuantitativa vs Cuantitativa (Diagrama de dispersi√≥n entre SAT Score y University GPA)

```{r}
p_sat_gpa <- crear_scatterplot(
  data = dataset_education,
  x = "sat_score",
  y = "university_gpa",
  title = "Relaci√≥n entre SAT Score y GPA Universitario",
  xlab = "SAT Score",
  ylab = "GPA Universitario",
  color = NULL,
  colores = "steelblue"
) +
  theme_classic(base_size = 16) +
  theme(
    plot.title = element_text(hjust = 0.5, size = 18, face = "bold"),
    axis.title = element_text(size = 16, face = "bold"),
    axis.text = element_text(size = 14)
  )


ggsave(here("reportes/Proy_Education_Career_Success/resultados_generados/scatter_sat_gpa.png"), 
       plot = p_sat_gpa, width = 8, height = 6, bg = "white")

ggplotly(p_sat_gpa)

```
