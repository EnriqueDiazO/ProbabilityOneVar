---
title: "Gu√≠a de Gr√°ficos para el An√°lisis Exploratorio de Datos (EDA)"
author: "Enrique D√≠az Ocampo"
date: "`r Sys.Date()`"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
# üìå Configuraci√≥n inicial
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```

## 1Ô∏è‚É£ **Introducci√≥n**
Esta gu√≠a proporciona una serie de gr√°ficos para realizar un **An√°lisis Exploratorio de Datos (EDA)** en diferentes niveles:

- **An√°lisis Unidimensional:** Distribuci√≥n de una sola variable.

- **An√°lisis Multivariado:** Relaci√≥n entre dos o m√°s variables.

- **Visualizaci√≥n con `ggplot2`** para explorar patrones en los datos.

Esta gu√≠a te ayudar√° a seleccionar el gr√°fico m√°s adecuado seg√∫n el tipo de variable analizada.

---

## 2Ô∏è‚É£ **Carga de Librer√≠as y Configuraci√≥n**
```{r}
# üìå Cargar librer√≠as necesarias
library(here)           # Manejo de rutas din√°micas
library(janitor)        # Limpieza de nombres de columnas
library(summarytools)   # Resumen estad√≠stico detallado
library(ggplot2)        # Gr√°ficos
library(dplyr)          # Manipulaci√≥n de datos
library(plotly)         # G≈ïaficos Interactivos

# üìå Configuraci√≥n de gr√°ficos globales
theme_set(theme_minimal())
source(here("reportes/Proy_Oral_Cancer_Prediction/00_CONFIGURACION.r"))

# üìå Cargar scripts de preprocesamiento
source(here("scripts/utils.r"))
source(here("scripts/1_preprocesamiento_esp_dataset.r"))
```

---

## 3Ô∏è‚É£ **Carga y Preprocesamiento de Datos**
```{r}
# üìå Cargar y preprocesar el dataset
dataset_oral_cancer <- preprocesar_datos(here("datasets/oral_cancer_data_limpio.csv"), "Oral Cancer")
```

üìå **¬øQu√© hace esta funci√≥n?**

‚úî Limpia los nombres de las columnas.

‚úî Convierte variables categ√≥ricas en factores.

‚úî Filtra valores inv√°lidos.

‚úî Retorna un dataset listo para an√°lisis.

---

## 4Ô∏è‚É£ **An√°lisis Unidimensional**
El an√°lisis unidimensional permite estudiar la distribuci√≥n de una sola variable.

### üìå **Boxplot para una variable cuantitativa**

```{r}
# Crear el boxplot mejorado
p_boxplot_edad <- ggplot(dataset_oral_cancer, aes(y = age)) +
  geom_boxplot(fill = "lightblue", color = "black", alpha = 0.7, outlier.color = "red", outlier.shape = 16) + 
  labs(title = "Distribuci√≥n de la Edad de los Pacientes", 
       y = "Edad", 
       x = "Pacientes") + 
  theme_classic(base_size = 16) + 
  theme(
    plot.title = element_text(hjust = 0.5, size = 20, face = "bold"),
    axis.title = element_text(size = 16, face = "bold"),
    axis.text = element_text(size = 14)
  )

# Guardar la imagen en la carpeta usando here()
ggsave(here("reportes/Proy_Oral_Cancer_Prediction/resultados_generados/boxplot_edad.png"), 
       plot = p_boxplot_edad, 
       width = 8, height = 6, bg = "white")

# Convertir a gr√°fico interactivo
ggplotly(p_boxplot_edad)
```
üìå **√ötil para:** Detectar valores at√≠picos y distribuci√≥n de datos.

### üìå **Histograma para una variable cuantitativa**
```{r}
# Crear el histograma mejorado
p_histograma_edad <- ggplot(dataset_oral_cancer, aes(x = age)) +
  geom_histogram(binwidth = 5, fill = "lightblue", color = "black", alpha = 0.7) +  # Color mejorado
  geom_density(aes(y = ..count.. * 5), color = "red", linetype = "dashed", size = 1.2) + # L√≠nea de densidad
  labs(title = "Distribuci√≥n de Edad de los Pacientes", 
       x = "Edad", 
       y = "Frecuencia") + 
  theme_classic(base_size = 16) + 
  theme(
    plot.title = element_text(hjust = 0.5, size = 20, face = "bold"),
    axis.title = element_text(size = 16, face = "bold"),
    axis.text = element_text(size = 14)
  )

# Guardar la imagen en la carpeta usando here()
ggsave(here("reportes/Proy_Oral_Cancer_Prediction/resultados_generados/boxplot_edad.png"), 
       plot = p_histograma_edad, 
       width = 8, height = 6, bg = "white")

# Convertir a gr√°fico interactivo
ggplotly(p_histograma_edad)
```
üìå **√ötil para:** Observar la distribuci√≥n de frecuencia de una variable num√©rica.


```{r}
# Definir colores personalizados para g√©nero
colores_genero <- c("Male" = "blue", "Female" = "red")

# Crear el histograma con ggplot2
p <- ggplot(dataset_oral_cancer, aes(x = age, fill = gender)) +
  geom_histogram(binwidth = 1, alpha = 0.5, position = "identity") +
  scale_fill_manual(values = colores_genero) +
  labs(title = "Histograma de Edad por G√©nero", x = "Edad", y = "Frecuencia", fill = "G√©nero") +
  theme_minimal(base_size = 16) +
  theme(
    plot.background = element_rect(fill = "white", color = NA), 
    panel.background = element_rect(fill = "white", color = NA), 
    plot.title = element_text(hjust = 0.5, size = 18, face = "bold"),
    axis.title = element_text(size = 16, face = "bold"),
    axis.text = element_text(size = 14),
    legend.title = element_text(size = 14, face = "bold"),
    legend.text = element_text(size = 12)
  )

# Guardar la imagen en la carpeta resultados_generados
ggsave(filename = here("reportes/Proy_Oral_Cancer_Prediction/resultados_generados/histograma_edad_genero.png"), plot = p, width = 8, height = 6)

# Convertir a gr√°fico interactivo
ggplotly(p)


```

```{r}
# Definir colores personalizados para uso del tabaco
colores_tabaco <- c("Yes" = "yellow", "No" = "gray")

# Crear el histograma
p2 <- ggplot(dataset_oral_cancer, aes(x = tumor_size_cm, fill = tobacco_use)) +
  geom_histogram(binwidth = 1, alpha = 0.5, position = "identity", color = "black") +
  scale_fill_manual(values = colores_tabaco) +
  labs(title = "Histograma de Tama√±o del Tumor por H√°bito de Fumar",
       x = "Tama√±o del Tumor (cm)", y = "Frecuencia", fill = "Fumador") +
  theme_minimal(base_size = 16) +
  theme(
    plot.background = element_rect(fill = "white", color = NA), 
    panel.background = element_rect(fill = "white", color = NA),
    plot.title = element_text(hjust = 0.5, size = 18, face = "bold"),
    axis.title = element_text(size = 16, face = "bold"),
    axis.text = element_text(size = 14),
    legend.title = element_text(size = 14, face = "bold"),
    legend.text = element_text(size = 12)
  )

# Guardar la imagen en la carpeta resultados_generados
ggsave(filename = here("reportes/Proy_Oral_Cancer_Prediction/resultados_generados/histograma_tamano_tumor.png"), plot = p2, width = 8, height = 6)

# Convertir a gr√°fico interactivo
ggplotly(p2)

```

### üìå **Barplot para una variable cualitativa**
```{r}
# Crear gr√°fico de barras con ggplot2
p_gender <- ggplot(dataset_oral_cancer, aes(x = gender, fill = gender)) +
  geom_bar() +
  labs(title = "Distribuci√≥n de G√©nero", x = "G√©nero", y = "Frecuencia", fill = "G√©nero") +
  scale_fill_manual(values = c("Male" = "cyan", "Female" = "pink")) +
  theme_classic(base_size = 16) +
  theme(
    plot.background = element_rect(fill = "white", color = NA),
    panel.background = element_rect(fill = "white", color = NA),
    plot.title = element_text(hjust = 0.5, size = 18, face = "bold"),
    axis.title = element_text(size = 16, face = "bold"),
    axis.text = element_text(size = 14),
    legend.title = element_text(size = 14, face = "bold"),
    legend.text = element_text(size = 12)
  )

# Guardar la imagen
ggsave(filename = here("reportes/Proy_Oral_Cancer_Prediction/resultados_generados/barplot_genero.png"), plot = p_gender, width = 8, height = 6, bg = "white")

# Convertir a gr√°fico interactivo
ggplotly(p_gender)

```
üìå **√ötil para:** Mostrar la frecuencia de categor√≠as en una variable cualitativa.


### üìå Gr√°fico Interactivo de Distribuci√≥n por Pa√≠s (Country)

```{r}
# Crear gr√°fico de barras para Country
p_country <- ggplot(dataset_oral_cancer, aes(x = reorder(country, country, function(x) -length(x)), fill = country)) +
  geom_bar() +
  labs(title = "Distribuci√≥n de Pacientes por Pa√≠s", x = "Pa√≠s", y = "Frecuencia", fill = "Pa√≠s") +
  coord_flip() +  # Rotar para mejor visualizaci√≥n
  theme_classic(base_size = 16) +
  theme(
    plot.background = element_rect(fill = "white", color = NA),
    panel.background = element_rect(fill = "white", color = NA),
    plot.title = element_text(hjust = 0.5, size = 18, face = "bold"),
    axis.title = element_text(size = 16, face = "bold"),
    axis.text = element_text(size = 12),
    legend.position = "none"  # Ocultar leyenda para mejor visualizaci√≥n
  )

# Guardar la imagen
ggsave(filename = here("reportes/Proy_Oral_Cancer_Prediction/resultados_generados/barplot_country.png"), plot = p_country, width = 8, height = 6, bg = "white")

# Convertir a gr√°fico interactivo
ggplotly(p_country)

```

---

## 5Ô∏è‚É£ **An√°lisis Multivariado**
El an√°lisis multivariado permite explorar relaciones entre dos o m√°s variables.

### üìå **Cualitativa vs Cualitativa** (Gr√°fico de barras cruzado)
```{r}
# Crear gr√°fico de barras con ggplot2
p_tabaco_genero <- ggplot(dataset_oral_cancer, aes(x = gender, fill = tobacco_use)) +
  geom_bar(position = "dodge") +
  labs(title = "Consumo de Tabaco por G√©nero", x = "G√©nero", y = "Frecuencia", fill = "Consumo de Tabaco") +
  scale_fill_manual(values = c("Yes" = "cyan", "No" = "green")) +
  theme_classic(base_size = 16) +
  theme(
    plot.background = element_rect(fill = "white", color = NA),
    panel.background = element_rect(fill = "white", color = NA),
    plot.title = element_text(hjust = 0.5, size = 18, face = "bold"),
    axis.title = element_text(size = 16, face = "bold"),
    axis.text = element_text(size = 14),
    legend.title = element_text(size = 14, face = "bold"),
    legend.text = element_text(size = 12)
  )

# Guardar imagen
ggsave(filename = here("reportes/Proy_Oral_Cancer_Prediction/resultados_generados/barplot_tabaco_genero.png"), plot = p_tabaco_genero, width = 8, height = 6, bg = "white")

# Convertir a gr√°fico interactivo
ggplotly(p_tabaco_genero)
```
üìå **√ötil para:** Comparar la frecuencia de categor√≠as en dos variables cualitativas.

### üìå **Cuantitativa vs Cualitativa** (Boxplot)
```{r}
# Definir colores personalizados para diagn√≥stico de c√°ncer oral
etapa_cancer <- c("0" = "darkorange", "1" = "dodgerblue", "2" = "cyan", "3" = "blue", "4"="black")

# Crear boxplot con ggplot2
p_edad_diagnostico <- ggplot(dataset_oral_cancer, aes(x = cancer_stage, y = tumor_size_cm, fill = cancer_stage)) +
  geom_boxplot() +
  labs(title = "Distribuci√≥n del Tama√±o del Tumor por Etapa del C√°ncer", 
       x = "Etapa del C√°ncer", 
       y = "Tama√±o del Tumor (cm)", 
       fill = "Diagn√≥stico") +
  scale_fill_manual(values = etapa_cancer) +
  theme_classic(base_size = 16) +
  theme(
    plot.background = element_rect(fill = "white", color = NA),
    panel.background = element_rect(fill = "white", color = NA),
    plot.title = element_text(hjust = 0.5, size = 18, face = "bold"),
    axis.title = element_text(size = 16, face = "bold"),
    axis.text = element_text(size = 14),
    legend.title = element_text(size = 14, face = "bold"),
    legend.text = element_text(size = 12)
  )

# Guardar imagen en la carpeta de resultados generados
ggsave(filename = here("reportes/Proy_Oral_Cancer_Prediction/resultados_generados/boxplot_tumor_cancer_stage.png"), plot = p_edad_diagnostico, width = 8, height = 6, bg = "white")

# Convertir a gr√°fico interactivo
ggplotly(p_edad_diagnostico)

```
üìå **√ötil para:** Comparar la distribuci√≥n de una variable num√©rica en funci√≥n de una variable categ√≥rica.

### üìå **Cuantitativa vs Cuantitativa** (Diagrama de dispersi√≥n)
```{r}
# Crear scatterplot con ggplot2
p_edad_tumor <- ggplot(dataset_oral_cancer, aes(x = age, y = tumor_size_cm)) +
  geom_point(alpha = 0.5, color = "steelblue") +
  labs(title = "Relaci√≥n entre Edad y Tama√±o del Tumor", x = "Edad", y = "Tama√±o del Tumor (cm)") +
  theme_classic(base_size = 16) +
  theme(
    plot.background = element_rect(fill = "white", color = NA),
    panel.background = element_rect(fill = "white", color = NA),
    plot.title = element_text(hjust = 0.5, size = 18, face = "bold"),
    axis.title = element_text(size = 16, face = "bold"),
    axis.text = element_text(size = 14)
  )

# Guardar imagen
ggsave(filename = here("reportes/Proy_Oral_Cancer_Prediction/resultados_generados/scatter_edad_tumor.png"), plot = p_edad_tumor, width = 8, height = 6, bg = "white")

# Convertir a gr√°fico interactivo
ggplotly(p_edad_tumor)

```
üìå **√ötil para:** Identificar tendencias y relaciones entre dos variables num√©ricas.

---

## **üìå Conclusi√≥n**
Esta gu√≠a ha mostrado c√≥mo aplicar distintos tipos de gr√°ficos seg√∫n el tipo de an√°lisis deseado:

‚úÖ **An√°lisis Unidimensional:** Estudio de una sola variable.
‚úÖ **An√°lisis Multivariado:** Exploraci√≥n de relaciones entre variables.
‚úÖ **Visualizaci√≥n con `ggplot2`** para obtener insights del dataset.

üöÄ **¬°Listo! Ahora puedes usar estas t√©cnicas para analizar cualquier dataset!** üéØüìä
