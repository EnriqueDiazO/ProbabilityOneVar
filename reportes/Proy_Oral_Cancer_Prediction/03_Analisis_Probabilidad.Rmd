---
title: "CÃ¡lculo de Probabilidades en Oral Cancer Dataset"
author: "Enrique DÃ­az Ocampo"
date: "`r Sys.Date()`"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```

1ï¸âƒ£ IntroducciÃ³n

Este anÃ¡lisis tiene como objetivo calcular probabilidades condicionales en el dataset Oral Cancer Prediction, respondiendo preguntas como:

âœ” Â¿CuÃ¡l es la probabilidad de tener un diagnÃ³stico positivo de cÃ¡ncer si el paciente fuma?
âœ” Â¿CÃ³mo influye el consumo de alcohol en el diagnÃ³stico?

Estos cÃ¡lculos son clave para evaluar factores de riesgo y mejorar la toma de decisiones en salud.

2ï¸âƒ£ Carga de LibrerÃ­as y ConfiguraciÃ³n


```{r}
# ğŸ“Œ Cargar librerÃ­as necesarias
library(here)           # Manejo de rutas dinÃ¡micas
library(janitor)        # Limpieza de nombres de columnas
library(summarytools)   # Resumen estadÃ­stico detallado
library(ggplot2)        # GrÃ¡ficos
library(dplyr)          # ManipulaciÃ³n de datos
library(plotly)         # GÅ•aficos Interactivos

# ğŸ“Œ ConfiguraciÃ³n de grÃ¡ficos globales
theme_set(theme_minimal())
source(here("reportes/Proy_Oral_Cancer_Prediction/00_CONFIGURACION.r"))

# ğŸ“Œ Cargar scripts de preprocesamiento
source(here("scripts/utils.r"))
source(here("scripts/1_preprocesamiento_esp_dataset.r"))
source(here("scripts/3_analisis_probabilidad.r"))
```

```{r}
# ğŸ“Œ Cargar dataset limpio
dataset_oral_cancer <- preprocesar_datos(here("datasets/oral_cancer_data_limpio.csv"), "Oral Cancer")
```


3ï¸âƒ£ CÃ¡lculo de Probabilidades Condicionales

Analizamos la relaciÃ³n entre factores de riesgo y diagnÃ³stico temprano de cÃ¡ncer.


## ğŸ“Œ Probabilidad de DiagnÃ³stico Positivo dado que el Paciente Fuma
```{r}
# Calcular probabilidades
resultados_tobacco <- calcular_probabilidades(
  data = dataset_oral_cancer,
  condicionante = "tobacco_use",
  objetivo = "early_diagnosis"
)

# Mostrar resultados
cat("Tabla de contingencia:\n")
print(resultados_tobacco$tabla_contingencia)

cat("\nProbabilidades condicionales:\n")
print(resultados_tobacco$probabilidades_condicionales)

cat("\nProbabilidades marginales de early_diagnosis:\n")
print(resultados_tobacco$probabilidades_marginales)

```


## ğŸ“Œ Probabilidad de DiagnÃ³stico Positivo dado que el Paciente Consume Alcohol
```{r}
# Calcular probabilidades para alcohol_consumption y early_diagnosis
resultado_alcohol <- calcular_probabilidades(
  data = dataset_oral_cancer,
  condicionante = "alcohol_consumption",
  objetivo = "early_diagnosis"
)

# Mostrar resultados
cat("\nProbabilidad de diagnÃ³stico positivo dado que el paciente consume alcohol:\n")
prob_positivo_alcohol <- resultado_alcohol$probabilidades_condicionales %>%
  filter(alcohol_consumption == "Yes", early_diagnosis == "Yes") %>%
  pull(prob_condicional)
print(prob_positivo_alcohol)

cat("\nTabla de contingencia para alcohol_consumption y early_diagnosis:\n")
print(resultado_alcohol$tabla_contingencia)

cat("\nProbabilidades condicionales:\n")
print(resultado_alcohol$probabilidades_condicionales)

cat("\nProbabilidades marginales de early_diagnosis:\n")
print(resultado_alcohol$probabilidades_marginales)
```



4ï¸âƒ£ VisualizaciÃ³n de Resultados

Generamos grÃ¡ficos interactivos para una mejor interpretaciÃ³n de los datos.

```{r}
# Visualizar probabilidades condicionales
p_tobacco <- visualizar_probabilidad_condicional(
  data = dataset_oral_cancer,
  condicionante = "tobacco_use",
  objetivo = "early_diagnosis",
  titulo = "Probabilidad de DiagnÃ³stico Temprano segÃºn Uso de Tabaco",
  xlab = "Uso de Tabaco",
  guardar = TRUE,
  ruta_guardado = here("reportes/Proy_Oral_Cancer_Prediction/resultados_generados/probabilidad_condicional_tobacco.png")
)

# Mostrar grÃ¡fico interactivo
p_tobacco

```


```{r}
# Visualizar probabilidades condicionales
p_alcohol <- visualizar_probabilidad_condicional(
  data = dataset_oral_cancer,
  condicionante = "alcohol_consumption",
  objetivo = "early_diagnosis",
  titulo = "Probabilidad de DiagnÃ³stico Temprano segÃºn Consumo de Alcohol",
  xlab = "Consumo de Alcohol",
  guardar = TRUE,
  ruta_guardado = here("reportes/Proy_Oral_Cancer_Prediction/resultados_generados/probabilidad_condicional_alcohol.png")
)

# Mostrar grÃ¡fico interactivo
p_alcohol

```


```{r}
p_tumors_vs_treatment <- visualizar_probabilidad_condicional(
  data = dataset_oral_cancer,
  condicionante = "treatment_type",
  objetivo = "tumor_size_cm",
  titulo = "Probabilidad tamaÃ±o del tumor segÃºn tratamiento ",
  xlab = "GÃ©nero",
  guardar = TRUE,
  ruta_guardado = here("reportes/Proy_Oral_Cancer_Prediction/resultados_generados/probabilidad_condicional_tumorsize_vs_treatment.png"),
  bins = 5  # Dividir en 5 intervalos
)

# Mostrar grÃ¡fico interactivo
p_tumors_vs_treatment
```
